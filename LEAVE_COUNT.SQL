CREATE PROCEDURE NEW_LEAVE_COUNT
(@EMP_ID INT,
@YEAR INT)
AS
BEGIN
	DECLARE
	@EMP_NAME VARCHAR(50),
	@LEAVE_TYPE VARCHAR(20),
	@LEAVE_DAYS INT,
	@TOTAL_LEAVE INT,
	@SICK INT =0,
	@CASUL INT =0,
	@YEARLY INT=0

	SELECT @EMP_NAME=FIRST_NAME+' '+LAST_NAME
	FROM employees WHERE employee_id = @EMP_ID;

	DECLARE LEAVE_CURSOR CURSOR -- LOCAL FAST_FORWARD
	FOR
		SELECT 
				LEAVE_TYPE,
				LEAVE_DAYS
		FROM LEAVE
		WHERE EMPLOYEE_ID= @EMP_ID
		AND YEAR(LEAVE_START_DATE) = @YEAR;

	OPEN LEAVE_CURSOR;
	
	FETCH NEXT FROM LEAVE_CURSOR 
	INTO @LEAVE_TYPE,@LEAVE_DAYS;

	WHILE @@FETCH_STATUS=0
		BEGIN 
			IF @LEAVE_TYPE = 'Sick' 
			BEGIN
				SET @SICK = @SICK+@LEAVE_DAYS
			END
			ELSE IF @LEAVE_TYPE='Casual'
			BEGIN
				SET @CASUL=@CASUL+@LEAVE_DAYS
			END
			ELSE IF @LEAVE_TYPE='Yearly'
			BEGIN
				SET @YEARLY=@YEARLY+@LEAVE_DAYS
			END

			
		FETCH NEXT FROM LEAVE_CURSOR 
		INTO @LEAVE_TYPE,@LEAVE_DAYS;
		END

	CLOSE LEAVE_CURSOR;
	DEALLOCATE LEAVE_CURSOR;

	SET @TOTAL_LEAVE = @SICK+@CASUL+@YEARLY
	

	PRINT 'EMPLOYEE NAME: '+@EMP_NAME+', '+'SICK LEAVE: '+ CAST(@SICK AS VARCHAR) +','
	+' CASUAL LEAVE: '+CAST(@CASUL AS VARCHAR)+ 'YEARLY LEAVE: '+CAST(@YEARLY AS VARCHAR)+', TOTAL LEAVE: '+CAST(@TOTAL_LEAVE AS VARCHAR)+'.'

END;
GO





EXEC NEW_LEAVE_COUNT @EMP_ID = 182, @YEAR = 2025;



DROP PROCEDURE NEW_LEAVE_COUNT;
